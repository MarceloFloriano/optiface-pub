(function(){"use strict";importScripts("https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/ort.min.js"),ort.env.wasm.wasmPaths="https://cdn.jsdelivr.net/npm/onnxruntime-web/dist/";let i=null;function d(c){const{data:s,width:n,height:e}=c,a=new Float32Array(3*n*e),o=[.485,.456,.406],r=[.229,.224,.225];for(let t=0;t<n*e;t++)a[t]=(s[t*4]/255-o[0])/r[0],a[t+n*e]=(s[t*4+1]/255-o[1])/r[1],a[t+2*n*e]=(s[t*4+2]/255-o[2])/r[2];return a}async function p(){i=await ort.InferenceSession.create("/face_shape_classifier.onnx"),postMessage({type:"ready"})}self.onmessage=async c=>{const{type:s,imageData:n}=c.data;if(s==="predict"&&i)try{const e=d(n),o={input:new ort.Tensor("float32",e,[1,3,224,224])},t=(await i.run(o)).output.data,l=t.indexOf(Math.max(...t));postMessage({type:"prediction",data:l})}catch(e){postMessage({type:"error",data:e.message})}},p()})();
