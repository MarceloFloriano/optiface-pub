import{a2 as f,b as m}from"./index.97f77435.js";const h=f("");fetch("/versao.json").then(async o=>{const a=await o.json();h.value=a.versao}).catch(async()=>{const a=await(await fetch(`/${new URL(location.href).pathname.split("/")[1]}/versao.json`)).json();h.value=a.versao});var A={versao:h};const c={foto:"",fotoOriginal:"",medidas:{},calcularDistanciasCartao:function(){let o=c.medidas;o.cartao.distanciapx=Math.hypot(Math.abs(o.cartao.p2.left-o.cartao.p1.left),Math.abs(o.cartao.p1.top-o.cartao.p2.top)),o.fator=o.cartao.distanciapx/o.cartao.tamanho,o.dip.total=Math.hypot(Math.abs(o.olhoDireito.centroOlho.left-o.olhoEsquerdo.centroOlho.left),Math.abs(o.olhoDireito.centroOlho.top-o.olhoEsquerdo.centroOlho.top))/o.fator;const a=(o.olhoDireito.centroOlho.top+o.olhoEsquerdo.centroOlho.top)/2;o.dnp.od=Math.hypot(Math.abs(o.olhoDireito.centroOlho.left-o.nariz.left),Math.abs(a-o.olhoDireito.centroOlho.top))/o.fator,o.dnp.oe=Math.hypot(Math.abs(o.olhoEsquerdo.centroOlho.left-o.nariz.left),Math.abs(a-o.olhoEsquerdo.centroOlho.top))/o.fator},calcularDistancias:function(){let o=c.medidas;const a=Math.hypot(Math.abs(o.olhoDireito.superior.left-o.olhoEsquerdo.superior.left),Math.abs(o.olhoDireito.superior.top-o.olhoEsquerdo.superior.top))/o.tamanhoArmacao;o.fator=a,o.tamanhoArmacaoPx=o.tamanhoArmacao*a,o.dip.total=Math.hypot(Math.abs(o.olhoDireito.centroOlho.left-o.olhoEsquerdo.centroOlho.left),Math.abs(o.olhoDireito.centroOlho.top-o.olhoEsquerdo.centroOlho.top))/a,o.dip.od.altura=(o.olhoDireito.inferior.top-o.olhoDireito.centroOlho.top)/a,o.dip.oe.altura=(o.olhoEsquerdo.inferior.top-o.olhoEsquerdo.centroOlho.top)/a,o.dnp.od=(o.tamanhoArmacaoPx/2-(o.olhoDireito.centroOlho.left-o.olhoDireito.superior.left))/a,o.dnp.oe=(o.tamanhoArmacaoPx/2-(o.olhoEsquerdo.superior.left-o.olhoEsquerdo.centroOlho.left))/a,o.ponte=(o.olhoEsquerdo.inferior.left-o.olhoDireito.inferior.left)/a,o.bifocalOlhoEsquerdo=o.olhoEsquerdo.bifocalAltura/a,o.bifocalOlhoDireito=o.olhoDireito.bifocalAltura/a,o.diagonal.distanciapx=Math.hypot(Math.abs(o.diagonal.p2.left-o.diagonal.p1.left),Math.abs(o.diagonal.p1.top-o.diagonal.p2.top)),o.diagonal.distancia=o.diagonal.distanciapx/a,o.alturaArmacaoPx=(o.olhoDireito.inferior.top-o.olhoDireito.superior.top+(o.olhoEsquerdo.inferior.top-o.olhoEsquerdo.superior.top))/2,o.alturaArmacao=o.alturaArmacaoPx/a},ler:async o=>{},async leFoto({id:o,tipoFoto:a}){const t=localStorage.getItem("bancoDeDados");try{const e=await $db.arquivo.le({name:`${t}/pupilometro/${o}/${o}_${a}`});return URL.createObjectURL(e)}catch(e){console.error("Erro ao ler foto online",e)}try{const e=await $db.arquivo.le({id:o});return URL.createObjectURL(e)}catch(e){console.error("Erro ao ler foto offline",e)}},async gravaFoto({base64:o,idPupilometro:a,tipoFoto:t}){const e=o.substring(11,o.indexOf(";base64"));await $db.arquivo.grava({original:{},atual:{arquivo:o,dataCriacao:$utils.dataAtual(),id:`${a}_${t}`,idTabelaMaster:a,nome:`${a}_${t}.${e}`,tipoArquivo:"pupilometro"}})},leListaCompleta:async o=>{var s,u;const{where:a,limit:t,page:e,sort:i,dir:r}=o,n=await $utils.geeksApi({listaPupilometro:{funcao:"53A62883-A918-496D-9AA4-972B983045F4",where:a,limit:t,page:e,sort:i,dir:r}});return(u=(s=n==null?void 0:n.data)==null?void 0:s.listaPupilometro)!=null?u:[]},limpar:function(){this.foto="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAQAAAAkGDomAAAATklEQVR42u3OMQEAAAgDINc/9Czh4QEJSDuvRVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUPDSAovln7Gzmi7KAAAAAElFTkSuQmCC",this.fotoOriginal="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFAAAABQCAQAAAAkGDomAAAATklEQVR42u3OMQEAAAgDINc/9Czh4QEJSDuvRVBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUFBQUPDSAovln7Gzmi7KAAAAAElFTkSuQmCC",this.medidas={tipo:"Pupilometro",tamanhoArmacao:100,tamanhoArmacaoPx:0,alturaArmacao:0,alturaArmacaoPx:0,olhoDireito:{superior:{left:257,top:462},centroOlho:{left:421,top:549},inferior:{left:540,top:699},bifocalAltura:0},olhoEsquerdo:{superior:{left:950,top:463},centroOlho:{left:784,top:549},inferior:{left:665,top:699},bifocalAltura:0},nariz:{left:0,top:0},dip:{total:0,od:{altura:0},oe:{altura:0}},dnp:{od:0,oe:0},ponte:0,bifocal:!1,bifocalOlhoEsquerdo:0,bifocalOlhoDireito:0,fator:0,diagonal:{p1:{left:0,top:0},p2:{left:0,top:0},distancia:0,distanciapx:0},cartao:{p1:{left:0,top:0},p2:{left:0,top:0},distancia:0,distanciapx:0,tamanho:86.6}}},obterImagemCameraInput:async function(){return new Promise(o=>{const a=document.createElement("input");a.setAttribute("type","file"),a.setAttribute("accept","image/*"),a.setAttribute("capture","environment"),a.addEventListener("cancel",t=>{o(null)}),a.addEventListener("change",()=>{const t=a.files;if(FileReader&&t&&t.length){const e=new FileReader;e.onload=async()=>{o(e.result)},e.readAsDataURL(t[0])}}),a.click()})}};c.limpar();const l="https://southamerica-east1-b15node-178618.cloudfunctions.net/storage";function p(o){if(!(o instanceof Date))throw new Error('Argumento "data" inv\xE1lido. Voc\xEA deve passar uma inst\xE2ncia de data');const a=o.getFullYear(),t=String(o.getMonth()+1).padStart(2,"0");return`${String(o.getDate()).padStart(2,"0")}/${t}/${a}`}var b={urlGCP:l,formatDate:p,async lista({bancoDeDados:o,tipoArquivo:a,idTabelaMaster:t}){if(!t)return[];let e=[];try{const i=o||localStorage.getItem("bancoDeDados");e=(await(await fetch(`${l}/${i}/${a}/${t}`,{method:"GET"})).json()).map(n=>({...n,...n.metadata,metadata:void 0}))}catch{}return[...e]},async le({tipoArquivo:o,idTabelaMaster:a,id:t,name:e,arquivo:i}){let r;const n=e.lastIndexOf(".")>0?e.substring(0,e.lastIndexOf(".")):e;return r=await fetch(`${l}/${n}`,{method:"GET"}),r.blob()},async grava({original:o,atual:a}){if(!a.nome)return;const t=$utils.compactarObjeto(a);await this.gravaOnline(t)||await $utils.sincronismoEnviar("adicionar","arquivo",t.id,t)},async gravaOnline(o,a){let t=!1;try{const e=o.nome.split(".").pop(),r=await(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({base64:o.arquivo.replace(/^data:[^;]+;base64,/,""),extensao:e,banco:a||localStorage.getItem("bancoDeDados"),metadata:{id:o.id,nome:o.nome,tipoArquivo:o.tipoArquivo||"-",idTabelaMaster:o.idTabelaMaster,dataCriacao:p(new Date($utils.dataAtual()))}})})).json();t=(r==null?void 0:r.erro)==="",t||console.error("Erro ao gravar arquivo online.",r)}catch{t=!1}return t},async gravaImagem({id:o,tipoArquivo:a,conteudo:t}){var i;let e=!1;try{const r=(i=t==null?void 0:t.match(/data:image\/(\w+);base64/i))==null?void 0:i[1];r||console.error("Erro ao gravar arquivo online. Conteudo base64 com formato invalido.",t);const s=await(await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({base64:t.replace(/^data:[^;]+;base64,/,""),extensao:r,banco:localStorage.getItem("bancoDeDados"),metadata:{id:o,nome:`${a}.${r}`,tipoArquivo:a,idTabelaMaster:o,dataCriacao:p(new Date($utils.dataAtual()))}})})).json();e=(s==null?void 0:s.erro)==="",e||console.error("Erro ao gravar imagem online.",s)}catch{e=!1}return e},async remove(o){const a=Array.isArray(o)?o:[o];if(!!a.length)for(let t of a)!(t!=null&&t.id)||await this.removeOnline(t)},async removeOnline(o){if(!o.name)return!0;let a=!1;try{const e=await(await fetch(l,{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:o.name})})).json();a=!0}catch{a=!1}return a},async edita({original:o,atual:a}){if(!!a.name)try{return await fetch(l,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({banco:localStorage.getItem("bancoDeDados"),path:a.name,dados:a})})}catch(t){return console.error(t),t}},async operacaoSincronismo(o,a,t){return o==="remover"?this.removeOnline(a):o==="adicionar"?this.gravaOnline(a,t):(console.error("Opera\xE7\xE3o inv\xE1lida para arquivos"),!0)}};const d={app:A,pupilometro:c,arquivo:b};var v=m(async({app:o})=>{o.config.globalProperties.$db=d,globalThis.$db=d});export{v as default};
