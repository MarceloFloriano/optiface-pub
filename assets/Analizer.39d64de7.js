import{_ as D,a2 as h,aq as E,o as I,c as V,w as M,d as g,P as $,a as l,x as N,M as q,t as O,O as T}from"./index.6d302593.js";import{V as F,S as Y,P as j,W as Q,D as Z,a as G,e as W,b as X}from"./STLLoader.81667887.js";const H={class:"q-mt-md text-left info-box"},i=640,c=480,J=1e3,K=2,U=.05,ee={__name:"Analizer",setup(ae){const p=h(null),m=h(null),x=h("");let d,r,f,e,u=new F;E(()=>{d=new Y,r=new j(75,i/c,.1,1e3),f=new Q({canvas:p.value,alpha:!0}),f.setSize(i,c);const a=new Z(16777215,1);a.position.set(0,0,1).normalize(),d.add(a),_()});function _(){requestAnimationFrame(_),f.render(d,r)}async function S(){const a=new window.FaceMesh({locateFile:n=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${n}`});a.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),a.onResults(L),new window.Camera(m.value,{onFrame:async()=>await a.send({image:m.value}),width:i,height:c}).start(),k()}function k(){new G().load("models3d/YO_6_53_v2_CANAL_V - YO FA - VERVE.STL",t=>{const n=new W;e=new X(t,n),t.computeBoundingBox(),t.boundingBox.getSize(u),t.center(),e.scale.setScalar(1),d.add(e);const o=r.fov*(Math.PI/180),s=Math.abs(u.length()/Math.tan(o/2));r.position.set(0,0,s),r.lookAt(new F(0,0,0))})}function L(a){if(!a.multiFaceLandmarks||a.multiFaceLandmarks.length===0||!e)return;const t=a.multiFaceLandmarks[0],n=t[168],o=t[234],s=t[454];e.position.set((n.x-.5)*i,-(n.y-.5+U)*c,n.z*J);const P=Math.sqrt((s.x-o.x)**2+(s.y-o.y)**2),v=(o.z+s.z)/2,y=P*i/u.x/(v+1);e.scale.setScalar(y);const w=Math.atan2(s.y-o.y,s.x-o.x);e.rotation.z=-w;const A=(o.x+s.x)/2,R=n.x-A;e.rotation.y=R*K;const b=(o.y+s.y)/2,C=n.y-b,B=n.z-v,z=Math.atan2(C,B)-Math.PI;e.rotation.x=z,x.value=`Nariz: (${e.position.x.toFixed(1)}, ${e.position.y.toFixed(1)}, ${e.position.z.toFixed(1)})
Escala: ${y.toFixed(3)}
Rotaci\xF3n X: ${(z*180/Math.PI).toFixed(1)}\xB0
Rotaci\xF3n Y: ${(e.rotation.y*180/Math.PI).toFixed(1)}\xB0
Rotaci\xF3n Z: ${(w*180/Math.PI).toFixed(1)}\xB0`}return(a,t)=>(I(),V(T,null,{default:M(()=>[g($,{class:"flex flex-center column"},{default:M(()=>[t[0]||(t[0]=l("h2",{class:"text-h5 q-mb-md"},"AR: Gafas STL con MediaPipe",-1)),l("div",{class:"relative q-mb-md",style:N({width:i+"px",height:c+"px"})},[l("video",{ref_key:"videoEl",ref:m,autoplay:"",playsinline:"",muted:"",width:i,height:c,style:{position:"absolute",top:"0",left:"0","z-index":"0"}},null,512),l("canvas",{ref_key:"canvas3d",ref:p,width:i,height:c,style:{position:"absolute",top:"0",left:"0","z-index":"1","pointer-events":"none"}},null,512)],4),g(q,{label:"Iniciar AR",color:"primary",onClick:S}),l("pre",H,O(x.value),1)]),_:1})]),_:1}))}};var oe=D(ee,[["__scopeId","data-v-a98576c8"]]);export{oe as default};
