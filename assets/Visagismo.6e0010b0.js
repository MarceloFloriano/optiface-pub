import{V as w,S as K,P as ee,W as te,D as ne,A as oe,G as ae,a as se,M as R,b as k,c as ie,Q as ce,d as le}from"./STLLoader.81667887.js";import{_ as re,a2 as y,aq as ue,o as de,j as ve,a as L,aX as _}from"./index.6d302593.js";const fe={id:"video-container"},he={class:"relative"},pe=["width","height"],me=["width","height"],xe=["width","height"],we={__name:"Visagismo",setup(ye,{expose:I}){I({iniciar:A,startAR:D,btnProporcoes:q,btnCor:H,btnMarcadores:N,btnCaptura:U});let c=y(0),i=y(0);const h=y(null),b=y(null),u=y(null);y("");const C=y(!0),z=y(!1);let M,p,T,m,x,F=new w;ue(async()=>{await A(),W()});async function A(){await new Promise(a=>{const o=setInterval(()=>{var n,s;((n=h.value)==null?void 0:n.videoWidth)>0&&((s=h.value)==null?void 0:s.videoHeight)>0&&(clearInterval(o),a())},100)});const t=document.getElementById("video-container");c.value=t.offsetWidth,i.value=t.offsetHeight,b.value.width=c.value,b.value.height=i.value,u.value.width=c.value,u.value.height=i.value,M=new K,p=new ee(75,c.value/i.value,.001,1e4),p.aspect=c.value/i.value,p.updateProjectionMatrix(),T=new te({canvas:b.value,alpha:!0}),T.setSize(c.value,i.value);const e=new ne(16777215,1);e.position.set(0,0,1).normalize(),M.add(e),M.add(new oe(16777215,.5)),V()}function V(){requestAnimationFrame(V),T.render(M,p)}function W(){x=new ae,M.add(x),new se().load("models3d/YO_6_53_v2_CANAL_V - YO FA - VERVE.STL",e=>{console.log("Modelo cargado");const a=new R({color:"#ff0000",shininess:100});m=new k(e,a),e.computeBoundingBox();const o=new w;e.boundingBox.getCenter(o),e.translate(-o.x,-o.y,-o.z),m=new k(e,a),e.boundingBox.getSize(F),e.boundingBox.getCenter(m.position).multiplyScalar(-1),m.scale.setScalar(1),x.add(m);const n=p.fov*(Math.PI/180),s=Math.abs(F.length()/Math.tan(n/2));p.position.set(0,0,s*2.5),p.lookAt(new w(0,0,0))})}async function D(){const t=new window.FaceMesh({locateFile:a=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${a}`});t.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t.onResults($),new window.Camera(h.value,{onFrame:async()=>await t.send({image:h.value}),width:Math.floor(c.value),height:Math.floor(i.value)}).start()}function E(t,e,a,o=0){const l=a+o,r=le.clamp((l- -.6)/(-.1- -.6),0,1),d=new w((t-.5)*2,-(e-.5)*2,r);return d.unproject(p),d}function $(t){var B;if(!((B=t.multiFaceLandmarks)!=null&&B.length)||!m||!x)return;const e=t.multiFaceLandmarks[0],a=.08,o=P=>E(e[P].x,e[P].y,e[P].z,a),n=o(33),s=o(263),l=o(1),r=n.distanceTo(s),d=r/F.x*1.6;x.scale.setScalar(d);const v=new w().subVectors(s,n).normalize(),f=new w().subVectors(l,n).normalize().cross(v).normalize(),g=new w().crossVectors(f,v).normalize(),S=new ie().makeBasis(v,g,f),Q=new ce().setFromRotationMatrix(S);x.matrixAutoUpdate=!0;const Y=new w().addVectors(n,s).multiplyScalar(.5),X=.03*r,Z=-.02*r,J=Y.clone().add(g.clone().multiplyScalar(-X)).add(f.clone().multiplyScalar(Z));x.position.copy(J),x.quaternion.copy(Q),j(e),O(e)}function j(t){if(!u.value||!t)return;const e=u.value.getContext("2d"),a=u.value.width,o=u.value.height;if(e.clearRect(0,0,a,o),!(!C.value||!t)){e.fillStyle="cyan",e.font="9px monospace";for(let n=0;n<t.length;n++){const s=t[n].x*a,l=t[n].y*o;e.beginPath(),e.arc(s,l,2,0,2*Math.PI),e.fill()}}}function O(t){if(G(t),!u.value||!z.value)return;const e=u.value.getContext("2d"),a=(t[10].y-(t[152].y-t[10].y)/4.5)*i.value,o=t[9].y*i.value,n=t[2].y*i.value,s=t[152].y*i.value;e.strokeStyle="lime",e.lineWidth=1.5;for(const f of[a,o,n,s])e.beginPath(),e.moveTo(0,f),e.lineTo(c.value,f),e.stroke();const l=o-a,r=n-o,d=s-n,v=l+r+d;e.fillStyle="yellow",e.font="24px monospace",e.fillText(`${(l/v*100).toFixed(1)}%`,10,(a+o)/2),e.fillText(`${(r/v*100).toFixed(1)}%`,10,(o+n)/2),e.fillText(`${(d/v*100).toFixed(1)}%`,10,(n+s)/2)}function G(t){if(!u.value||!z.value)return;const e=u.value.getContext("2d"),a=t[2].y*i.value,o=t[13].y*i.value,n=t[14].y*i.value,s=t[152].y*i.value,l=(o+n)/2,r=(n+s)/2;e.strokeStyle="blue",e.lineWidth=1.5;for(const S of[l,r,a,s])e.beginPath(),e.moveTo(0,S),e.lineTo(c.value,S),e.stroke();const d=l-a,v=r-l,f=s-r,g=d+v+f;e.fillStyle="blue",e.font="24px monospace",e.fillText(`${(d/g*100).toFixed(1)}%`,c.value-60,(l+a)/2),e.fillText(`${(v/g*100).toFixed(1)}%`,c.value-60,(l+r)/2),e.fillText(`${(f/g*100).toFixed(1)}%`,c.value-60,(r+s)/2)}function q(){z.value=!z.value}function H(t){!m||(m.material=new R({color:t,shininess:100}))}function N(){C.value=!C.value}function U(){const t=document.createElement("canvas");return t.width=h.value.videoWidth,t.height=h.value.videoHeight,t.getContext("2d").drawImage(h.value,0,0,t.width,t.height),t.toDataURL("image/png")}return(t,e)=>(de(),ve("div",fe,[L("div",he,[L("video",{ref_key:"videoEl",ref:h,autoplay:"",playsinline:"",muted:"",width:_(c),height:_(i),style:{position:"absolute",top:"0",left:"0","z-index":"0","object-fit":"fill"}},null,8,pe),L("canvas",{ref_key:"canvas3d",ref:b,width:_(c),height:_(i),style:{position:"absolute",top:"0",left:"0","z-index":"1","pointer-events":"none"}},null,8,me),L("canvas",{ref_key:"canvasLandmarks",ref:u,width:_(c),height:_(i),style:{position:"absolute",top:"0",left:"0","z-index":"2","pointer-events":"none"}},null,8,xe)])]))}};var Me=re(we,[["__scopeId","data-v-e0e54616"]]);export{Me as default};
