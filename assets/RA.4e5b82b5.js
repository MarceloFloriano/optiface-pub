import{_ as j,a2 as u,aq as P,ac as Q,o as y,c as H,w as L,d as b,P as $,a as l,M as N,j as A,l as E,f as z,t as q,O as G}from"./index.97f77435.js";const J={class:"q-mb-md row items-center"},K={class:"relative q-mb-md"},Z={key:0,class:"q-mb-md"},ee=["src"],ae={key:1,class:"q-mb-md"},te={class:"text-h6"},ne={key:2,class:"text-negative q-mt-md"},oe={__name:"RA",setup(se){const k=u(null),a=u(null),I=u(null);let s=null,c=null;const m=u(!1),d=u(""),C=u(""),R=u(""),B=["Heart","Oblong","Oval","Round","Square"];let p=null,M=!1;const x=new window.FaceMesh({locateFile:n=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${n}`});x.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),x.onResults(T);async function S(){p=new Worker("/assets/onnx-worker.af18dc4e.js"),p.onmessage=n=>{const{type:e,data:o}=n.data;e==="ready"?(M=!0,console.log("\u2705 Worker ONNX listo")):e==="prediction"?R.value=B[o]||"Desconocido":e==="error"&&(console.error("\u274C Worker error:",o),d.value="Error en clasificaci\xF3n.")}}function O(n){let e=1,o=1,i=0,r=0;for(const t of n)t.x<e&&(e=t.x),t.y<o&&(o=t.y),t.x>i&&(i=t.x),t.y>r&&(r=t.y);return{minX:e,minY:o,maxX:i,maxY:r}}async function T(n){if(s.save(),s.clearRect(0,0,a.value.width,a.value.height),s.drawImage(n.image,0,0,a.value.width,a.value.height),!n.multiFaceLandmarks||n.multiFaceLandmarks.length===0){d.value="No se detect\xF3 ninguna cara.",s.restore();return}d.value="";const e=n.multiFaceLandmarks[0];if(window.drawConnectors(s,e,window.FACEMESH_TESSELATION,{color:"#C0C0C070",lineWidth:1}),window.drawLandmarks(s,e,{color:"#FF3030",radius:1}),!M){s.restore();return}const{minX:o,minY:i,maxX:r,maxY:t}=O(e),w=.5;let f=o*a.value.width,v=i*a.value.height,h=(r-o)*a.value.width,g=(t-i)*a.value.height;f=f-h*w/2,v=v-g*w/2,h=h*(1+w),g=g*(1+w),f=Math.max(0,f),v=Math.max(0,v),h=Math.min(a.value.width-f,h),g=Math.min(a.value.height-v,g);const _=document.createElement("canvas");_.width=224,_.height=224;const D=_.getContext("2d");D.drawImage(a.value,f,v,h,g,0,0,224,224),C.value=_.toDataURL();const Y=D.getImageData(0,0,224,224);p.postMessage({type:"predict",imageData:Y}),s.restore()}function U(){m.value=!m.value,d.value="",m.value?W():F()}function W(){c&&c.stop(),c=new window.Camera(k.value,{onFrame:async()=>await x.send({image:k.value}),width:640,height:480}),c.start()}function F(){c&&(c.stop(),c=null),s.clearRect(0,0,a.value.width,a.value.height)}function X(){d.value="",m.value&&(F(),m.value=!1),I.value.click()}function V(n){const e=n.target.files[0];if(!e)return;const o=new FileReader;o.onload=async i=>{const r=new Image;r.src=i.target.result,r.onload=async()=>{const t=document.createElement("canvas");t.width=640,t.height=480,t.getContext("2d").drawImage(r,0,0,640,480),await x.send({image:t})}},o.readAsDataURL(e)}return P(async()=>{s=a.value.getContext("2d"),S()}),Q(()=>{F(),p&&p.terminate()}),(n,e)=>(y(),H(G,null,{default:L(()=>[b($,{class:"flex flex-center column"},{default:L(()=>[e[2]||(e[2]=l("h2",{class:"text-h5 q-mb-md"},"REALIDADE AUMENTADA + Face Shape",-1)),l("div",J,[b(N,{onClick:U,label:m.value?"Detener AR":"Iniciar AR",color:"primary",class:"q-mr-sm"},null,8,["label"]),b(N,{onClick:X,label:"Cargar Imagen",color:"secondary"}),l("input",{ref_key:"fileInput",ref:I,type:"file",accept:"image/*",onChange:V,style:{display:"none"}},null,544)]),l("div",K,[l("video",{ref_key:"videoEl",ref:k,playsinline:"",muted:"",style:{display:"none"}},null,512),l("canvas",{ref_key:"canvasEl",ref:a,width:"640",height:"480",style:{border:"2px solid #00ffff"}},null,512)]),C.value?(y(),A("div",Z,[e[0]||(e[0]=l("h5",{class:"text-subtitle2"},"Rostro detectado:",-1)),l("img",{src:C.value,width:"112",height:"112",style:{"border-radius":"8px",border:"2px solid cyan"}},null,8,ee)])):E("",!0),R.value?(y(),A("div",ae,[l("p",te,[e[1]||(e[1]=z("Forma detectada: ")),l("b",null,q(R.value),1)])])):E("",!0),d.value?(y(),A("p",ne,q(d.value),1)):E("",!0)]),_:1})]),_:1}))}};var re=j(oe,[["__scopeId","data-v-0a528ff8"]]);export{re as default};
