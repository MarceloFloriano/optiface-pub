import{V as k,S as G,P as H,W as X,D as U,A as J,a as K,M as R,b as Q}from"./STLLoader.1a9c65b8.js";import{_ as ee,L as f,O as te,o as ne,j as oe,a as z,b6 as v,Z as ae}from"./index.4ffd6295.js";const ie={id:"video-container"},se=["width","height"],ce=["width","height"],le=["width","height"],re=1e3,ue=2,de=.05,he={__name:"Visagismo",setup(fe,{expose:I}){I({iniciar:C,startAR:B,btnProporcoes:Y,btnCor:j,btnMarcadores:Z,btnCaptura:q});let i=f(0),o=f(0);const m=f(null),$=f(null),x=f(null),V=f(""),S=f(!0),b=f(!1);let _,w,P,s,T=new k;te(async()=>{await C()});async function C(){i.value=$utils.tela("video-container").width,o.value=$utils.tela("video-container").height,_=new G,w=new H(75,i.value/o.value,.1,1e3),P=new X({canvas:$.value,alpha:!0}),P.setSize(i.value,o.value);const t=new U(16777215,1);t.position.set(0,0,1).normalize(),_.add(t);const e=new J(16777215,.5);_.add(e),E()}function E(){requestAnimationFrame(E),P.render(_,w)}async function B(){const t=new window.FaceMesh({locateFile:n=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${n}`});t.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),t.onResults(W),new window.Camera(m.value,{onFrame:async()=>await t.send({image:m.value}),width:i.value,height:o.value}).start(),A()}function A(){new K().load("models3d/YO_6_53_v2_CANAL_V - YO FA - VERVE.STL",e=>{const n=new R({color:"#ff0000",shininess:100});s=new Q(e,n),e.computeBoundingBox(),e.boundingBox.getSize(T),e.center(),s.scale.setScalar(1),_.add(s);const c=w.fov*(Math.PI/180),a=Math.abs(T.length()/Math.tan(c/2));w.position.set(0,0,a),w.lookAt(new k(0,0,0))})}function D(t){if(!x.value)return;const e=x.value.getContext("2d");if(e.clearRect(0,0,i.value,o.value),!(!S.value||!t)){e.fillStyle="cyan";for(let n of t){const c=n.x*i.value,a=n.y*o.value;e.beginPath(),e.arc(c,a,1.5,0,2*Math.PI),e.fill()}}}function N(t){if(O(t),!x.value||!b.value)return;const e=x.value.getContext("2d");if(!e)return;const n=t[10].y*o.value,c=t[152].y*o.value,a=n-(c-n)/4.5,r=t[9].y*o.value,l=t[2].y*o.value,u=t[152].y*o.value;e.strokeStyle="lime",e.lineWidth=1.5,[a,r,l,u].forEach(L=>{e.beginPath(),e.moveTo(0,L),e.lineTo(i.value,L),e.stroke()});const h=r-a,p=l-r,y=u-l,d=h+p+y,F=(h/d*100).toFixed(1),M=(p/d*100).toFixed(1),g=(y/d*100).toFixed(1);e.fillStyle="yellow",e.font="24px monospace",e.fillText(`${F}%`,10,(a+r)/2),e.fillText(`${M}%`,10,(r+l)/2),e.fillText(`${g}%`,10,(l+u)/2)}function O(t){if(!x.value||!b.value)return;const e=x.value.getContext("2d");if(!e)return;const n=t[2].y*o.value,c=t[13].y*o.value,a=t[14].y*o.value,r=t[152].y*o.value,l=(c+a)/2,u=(a+r)/2;e.strokeStyle="blue",e.lineWidth=1.5,[l,u,n,r].forEach(L=>{e.beginPath(),e.moveTo(0,L),e.lineTo(i.value,L),e.stroke()});const h=l-n,p=u-l,y=r-u,d=h+p+y,F=(h/d*100).toFixed(1),M=(p/d*100).toFixed(1),g=(y/d*100).toFixed(1);e.fillStyle="blue",e.font="24px monospace",e.fillText(`${F}%`,i.value-60,(l+n)/2),e.fillText(`${M}%`,i.value-60,(l+u)/2),e.fillText(`${g}%`,i.value-60,(u+r)/2)}function W(t){if(!t.multiFaceLandmarks||t.multiFaceLandmarks.length===0||!s)return;const e=t.multiFaceLandmarks[0],n=e[168],c=e[234],a=e[454];s.position.set((n.x-.5)*i.value,-(n.y-.5+de)*o.value,n.z*re);const r=Math.sqrt((a.x-c.x)**2+(a.y-c.y)**2),l=(c.z+a.z)/2,u=r*i.value/T.x/(l+1);s.scale.setScalar(u);const h=Math.atan2(a.y-c.y,a.x-c.x);s.rotation.z=-h;const p=(c.x+a.x)/2,y=n.x-p;s.rotation.y=y*ue;const d=(c.y+a.y)/2,F=n.y-d,M=n.z-l,g=Math.atan2(F,M)-Math.PI;s.rotation.x=g,V.value=`Nariz: (${s.position.x.toFixed(1)}, ${s.position.y.toFixed(1)}, ${s.position.z.toFixed(1)})
Escala: ${u.toFixed(3)}
Rotaci\xF3n X: ${(g*180/Math.PI).toFixed(1)}\xB0
Rotaci\xF3n Y: ${(s.rotation.y*180/Math.PI).toFixed(1)}\xB0
Rotaci\xF3n Z: ${(h*180/Math.PI).toFixed(1)}\xB0`,D(e),N(e)}function Y(){b.value=!b.value}function j(t){!s||(s.material=new R({color:t,shininess:100}))}function Z(){S.value=!S.value}function q(){const t=document.createElement("canvas");return t.width=m.value.videoWidth,t.height=m.value.videoHeight,t.getContext("2d").drawImage(m.value,0,0,t.width,t.height),t.toDataURL("image/png")}return(t,e)=>(ne(),oe("div",ie,[z("div",{class:"relative",style:ae({width:v(i)+"px",height:v(o)+"px"})},[z("video",{ref_key:"videoEl",ref:m,id:"videoEl",autoplay:"",playsinline:"",muted:"",width:v(i),height:v(o),style:{position:"absolute",top:"0",left:"0","z-index":"0"}},null,8,se),z("canvas",{ref_key:"canvas3d",ref:$,width:v(i),height:v(o),style:{position:"absolute",top:"0",left:"0","z-index":"1","pointer-events":"none"}},null,8,ce),z("canvas",{ref_key:"canvasLandmarks",ref:x,width:v(i),height:v(o),style:{position:"absolute",top:"0",left:"0","z-index":"2","pointer-events":"none"}},null,8,le)],4)]))}};var pe=ee(he,[["__scopeId","data-v-3faae28a"]]);export{pe as default};
